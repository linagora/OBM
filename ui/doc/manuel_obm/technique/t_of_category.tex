% Documentation technique d'OBM : Gestion des catégories
% ALIACOM Pierre Baudracco
% $Id$


\subsection{Gestion des catégories}
\label{of_category}

\obm gère des catégories multivaluées (n-n) pour plusieurs modules : \company, \contact, \deal... et il est souvent demandé d'ajouter des catégories lors de l'intégration de projets clients.

Toutes ces catégories fonctionnent selon le même principe et possèdent le même format de stockage.

Cette librairie propose une gestion générique des catégories avec liaisons 1-n -mode = mono) ou n-n (mode = multi) offrant :\\

\begin{itemize}
\item Gestion de catégories avec codes (1.2.10, 3.2,...) et labels
\item Fonctions de gestion des champs de recherche de catégorie
\item Fonctions de gestion des champs catégorie dans les formulaires
\item Affichage en mode arborescence, avec sélection simple ou multiple
\end{itemize}
\vspace{0.3cm}

Les fonctionalités de catégories sont fournies par le fichier \fichier{of/of\_category.inc}


\subsubsection{Types de catégories}

\obm distingue 2 types de catégories :\\
\begin{itemize}
\item \textbf{mono} : catégories avec liaisons 1-n. L'entité n'est liée qu'à 0 ou 1 des catégories
\item \textbf{multi} : catégories avec liaisons n-n. L'entité peut être liée à 0, 1  ou n catégories.
\end{itemize}

\subsubsection{Modèle de stockage générique}

Pour une catégorie ``mono'' d'un module, l'entité du module doit contenir un champ référençant la catégorie \variable{entite\_category1\_id} et 1 table doit être créée :\\

\begin{itemize}
\item ModuleCategory1 (ou ModuleCategory2 si plusieurs catégories pour le module)
\end{itemize}
\vspace{0.3cm}

Pour une catégorie ``multi'' d'un module, 2 tables doivent être créées :\\

\begin{itemize}
\item ModuleCategory1 (ou ModuleCategory2 si plusieurs catégories pour le module)
\item ModuleCategory1Link (ou ModuleCategory2Link)
\end{itemize}
\vspace{0.3cm}

Table des informations d'une catégorie, ModuleCategory (ex: CompanyCategory) :\\

\begin{tabular}{|p{3cm}|c|p{4cm}|p{4cm}|}
\hline
\textbf{Champs} & \textbf{Type} & \textbf{Description} & \textbf{Commentaire} \\
\hline
\_id & int 8 & Id de la catégorie & \\
\hline
\_code & varchar 10 & Code de la catégorie & ex: 1.0, 1.1, 1.1.4 \\
\hline
\_label & varchar 100 & Label de la catégorie & \\
\hline
\end{tabular}
\vspace{0.3cm}

Table des informations de liaison d'une catégorie avec un module, ModuleCategoryLink (ex: CompanyCategoryLink) :\\

\begin{tabular}{|p{3cm}|c|p{4cm}|}
\hline
\textbf{Champs} & \textbf{Type} & \textbf{Description}\\
\hline
\_category\_id & int 8 & Id de la catégorie\\
\hline
\_company\_id & int 8 & Id de l'entité du module\\
\hline
\end{tabular}


\subsubsection{Implémentation : API fonctions publiques}

\shadowbox{
\begin{minipage}{13cm}
\begin{verbatim}
of_category_dis_tree($params, $action, $entity, $cat) {
\end{verbatim}
\end{minipage}
}
Affichage de l'arborescence de la catégorie ``\$cat'' pour l'entité (souvent module) \$entity.
Si l'action demandée est du type ext\_get\_cat[1-9]?\_ids, l'affichage propose une sélection par checkbox, sinon une sélection directe unique par lien.\\


\shadowbox{
\begin{minipage}{13cm}
\begin{verbatim}
of_category_get_ordered($entity, $cat, $mode="multi", $entity_id=0) {
\end{verbatim}
\end{minipage}
}

\begin{tabular}{|p{3cm}|p{10cm}|}
\hline
\textbf{Paramètres} & \textbf{Description}\\
\hline
\multicolumn{2}{|c|}{Récupération de la liste des catégories ordonnées selon le code}\\
\hline
\$entity & entité (ex: ``company'', ``contact'',..)\\
\hline
\$cat & catégorie (ex: ``catégorie1, ``type'',..)\\
\hline
\$mode & ``mono'' ou ``multi'' pour indiquer le type de liaison vers l'entité\\
\hline
\$entity\_id & pour mode ``multi''. Si donné, uniquement entrées liées à cette entité\\
\hline
\end{tabular}
\vspace{0.3cm}



\shadowbox{
\begin{minipage}{13cm}
\begin{verbatim}
of_category_dis_search_select($entity, $cat, $cats, $cat_id, $sel_append="") {
\end{verbatim}
\end{minipage}
}

\begin{tabular}{|p{3cm}|p{10cm}|}
\hline
\textbf{Paramètres} & \textbf{Description}\\
\hline
\multicolumn{2}{|c|}{Fonction d'affichage du champ de recherche de la catégorie pour le formulaire de recherche}\\
\hline
\$entity & entité (ex: ``company'', ``contact''\\
\hline
\$cat & catégorie (ex: ``catégorie1, ``type'',...\\
\hline
\$cats & tableau des catégories à afficher\\
\hline
\$cat\_id & entrée sélectionnée\\
\hline
\$sel\_append & chaine à insérer dans la définition du <select> (ex: code javascript)\\
\hline
\end{tabular}
\vspace{0.3cm}


\shadowbox{
\begin{minipage}{13cm}
\begin{verbatim}
of_category_dis_entity_form($entity, $cat, $cats, $cat_num="", $entity) {
\end{verbatim}
\end{minipage}
}

\begin{tabular}{|p{3cm}|p{10cm}|}
\hline
\textbf{Paramètres} & \textbf{Description}\\
\hline
\multicolumn{2}{|c|}{Fonction d'affichage du champ catégorie pour le formulaire du module \$entity}\\
\hline
\$entity & entité (ex: ``company'', ``contact''\\
\hline
\$cat & catégorie (ex: ``catégorie1, ``type'',...\\
\hline
\$cats & tableau des catégories à afficher\\
\hline
\$mode & ``mono'' ou ``multi'' pour indiquer le type de liaison vers l'entité\\
\hline
\$cat\_id & pour mode ``mono'' entrée catégorie sélectionnée\\
\hline
\end{tabular}
\vspace{0.3cm}
