% Documentation technique d'OBM : module Facture
% ALIACOM Pierre Baudracco
% $Id$


\clearpage
\section{Facture}

Le module \invoice \obm.

\subsection{Organisation de la base de données}

Le module \invoice utilise 3 tables :
\begin{itemize}
 \item Invoice
 \item InvoiceStatus
 \item InvoiceTerm
\end{itemize}

\subsection{Invoice}
Table principale des informations d'une facture.\\

\begin{tabular}{|p{3cm}|c|p{5.4cm}|p{2.6cm}|}
\hline
\textbf{Champs} & \textbf{Type} & \textbf{Description} & \textbf{Commentaire} \\
\hline
\_id & int 8 & Identifiant & Clé primaire \\
\hline
\_timeupdate & timestamp 14 & Date de mise à jour & \\
\hline
\_timecreate & timestamp 14 & Date de création & \\
\hline
\_userupdate & int 8 & Id du modificateur & \\
\hline
\_usercreate & int 8 & Id du createur & \\
\hline
\_company\_id & int 8 & Société client ou forunisseur & \\
\hline
\_deal\_id & int 8 & Affaire concernée & \\
\hline
\_project\_id & int 8 & Projet concerné & \\
\hline
\_number & varchar 10 & Numéro de la facture & \\
\hline
\_label & varchar 128 & Label & \\
\hline
\_amount\_ht & double 10,2 & montant Hors taxe &\\
\hline
\_amount\_ttc & double 10,2 & montant TTC &\\
\hline
\_status\_id & int 4 & Etat & \\
\hline
\_date & date & Jour de facturation & prévu ou réel \\
\hline
\_inout & char 1 & Type client ou fournisseur & (+ client, - fournisseur) \\
\hline
\_archive & char 1 & Indicateur d'archivage & (1 = 0ui)\\
\hline
\_comment & text (64k) & Commentaire &\\
\hline
\end{tabular}


\subsection{InvoiceStatus}
Table des informations des états des factures.\\

\begin{tabular}{|p{3cm}|c|p{5.4cm}|p{2.6cm}|}
\hline
\textbf{Champs} & \textbf{Type} & \textbf{Description} & \textbf{Commentaire} \\
\hline
\_id & int 8 & Identifiant & Clé primaire \\
\hline
\_payment & int 1 & Indicateur facture doit avoir des paiements & (1 = Oui) \\
\hline
\_archive & char 1 & Indicateur facture de cet Etat est archivable & (1 = 0ui)\\
\hline
\_label & varchar 24 & Label de l'état & \\
\hline
\end{tabular}


\subsubsection{Valeurs par défaut}

Il est possible de gérer ses propres états de factures mais des états par défaut sont définis :\\

\begin{tabular}{|p{3cm}|c|c|p{6cm}|}
\hline
\textbf{Etat} & \textbf{Paiement} & \textbf{Archivable} & \textbf{Commentaire} \\
\hline
A créer &  &  & \\
\hline
Envoyée & X  &  & \\
\hline
Payée en partie & X &  & \\
\hline
Litige & X &  & \\
\hline
Annulée &  & X & \\
\hline
Pertes et profits &  & X & \\
\hline
Payée & X & X & \\
\hline
\end{tabular}

\subsubsection{Remarques}

\paragraph{L'ordre d'affichage} des états est : ``Non archivable, Pas de paiements'', ce qui donne l'ordre du tableau ci-dessus.


\subsection{ProjectTerm}
Table des consitions de règlement ou délais de paiements.

\begin{tabular}{|p{3cm}|c|p{5.4cm}|p{2.6cm}|}
\hline
\textbf{Champs} & \textbf{Type} & \textbf{Description} & \textbf{Commentaire} \\
\hline
\_id & int 8 & Identifiant & Clé primaire \\
\hline
\_project\_id & int 8 & Projet & \\
\hline
\_user\_id & int 8 & Utilisateur & \\
\hline
\_projecttask\_id & int 8 & Tâche & \\
\hline
\_timeupdate & timestamp 14 & Date de mise à jour & \\
\hline
\_timecreate & timestamp 14 & Date de création & \\
\hline
\_userupdate & int 8 & Id du modificateur & \\
\hline
\_usercreate & int 8 & Id du createur & \\
\hline
\_projectedtime & int 8 & Durée prévue & \\
\hline
\_missingtime & int 8 & Durée restante estimée & Par Chef P \\
\hline
\_validity & timestamp 14 & Date d'estimation d'avancement & \\
\hline
\_soldprice & int 8 & Prix de vente de l'utilisateur & \\
\hline
\_manager & int 1 & Statut de l'utilisateur dans le projet (si tâche est nulle) & 1 = CP \\
\hline
\end{tabular}



\subsection{Actions et droits}

Voici la liste des actions du module \project, avec le droit d'accès requis ainsi qu'une description sommaire de chacune d'entre elles.\\

\begin{tabular}{|l|c|p{9.5cm}|}
 \hline
 \textbf{Intitulé} & \textbf{Droit} & \textbf{Description} \\
 \hline
 \hline
  index & read & (Défaut) formulaire de recherche de factures. \\ 
 \hline
  search & read & Résultat de recherche de factures. \\
 \hline
  new & write & Formulaire de création d'une facture. \\
 \hline
  detailconsult & read & Fiche détail d'une facture. \\
 \hline
  detailupdate & write & Formulaire de modification d'une facture. \\
 \hline
  duplicate & write & Formulaire de création à partir d'une facture existante. \\
 \hline
  insert & write & Insertion d'une facture. \\
 \hline
  update & write & Mise à jour d'une facture. \\
 \hline
  check\_delete & write & Vérification avant suppression d'une facture. \\
 \hline
  delete & write & Suppression d'une facture projet. \\
 \hline
  display & read & Ecran de modification des préférences d'affichage. \\
 \hline
  dispref\_display & read & Modifie l'affichage d'un élément. \\
 \hline
  dispref\_level & read & Modifie l'ordre d'affichage d'un élément. \\
 \hline
  document\_add & write & Ajout de liens vers des documents. \\
 \hline
\end{tabular}
